%--------------------------------------------------------------------------
% Edited by bbl
% Date: 2024-03-17(yyyy-mm-dd)
% PolyPhaseNetwork analysis
%--------------------------------------------------------------------------
function [ang, Suppression] = funAnaPN(R, C, RL, ft)
n = length(R);
N = length(ft);
L = [1/RL(1),      0,       0,       0;
           0,1/RL(1),       0,       0;
           0,      0, 1/RL(1),       0;
           0,      0,       0, 1/RL(1);];
I = [      1,      0,       0,       0;
           0,      1,       0,       0;
           0,      0,       1,       0;
           0,      0,       0,       1;];
Vin = [    1;
           1;
          -1;
          -1;];
for ii=1:N
    f = ft(ii);
    A = MA(R(1),R(1),R(1),R(1),C(1),C(1),C(1),C(1),f);
    for m = 2:n
        Ax = MA(R(m),R(m),R(m),R(m),C(m),C(m),C(m),C(m),f);
        A = A*Ax;
    end
    A11 = A(1:4,1:4);
    A12 = A(1:4,5:8);
    A21 = A(5:8,1:4);
    A22 = A(5:8,5:8);
    Vout = (I-A12/A22*L)\(A11-A12/A22*A21*Vin);
    Va(ii) = Vout(3)-Vout(1);
    Vb(ii) = Vout(4)-Vout(2);
end
ang = angle(Va./Vb);
Suppression = 20*log10(cot((ang-pi/2)/2));

function A = MA(R1, R2, R3, R4, C1, C2, C3, C4, f)
w = 2*pi*f;
I = [      1,      0,       0,       0;
           0,      1,       0,       0;
           0,      0,       1,       0;
           0,      0,       0,       1;];
M11 = [1/R1+1i*w*C1,            0,           0,             0;
                  0, 1/R2+1i*w*C2,           0,             0;
                  0,            0, 1/R3+1i*w*C3,            0;
                  0,            0,            0, 1/R4+1i*w*C4];
M12 = [       -1/R1,            0,           0,      -1i*w*C1;
           -1i*w*C2,        -1/R2,           0,             0;
                  0,     -1i*w*C3,       -1/R3,             0;
                  0,            0,    -1i*w*C4,        -1/R4];
M21 = [        1/R1,      1i*w*C2,           0,             0;
                  0,         1/R2,     1i*w*C3,             0;
                  0,            0,        1/R3,       1i*w*C4;
            1i*w*C1,            0,           0,         1/R4];
M22 = [-1/R1-1i*w*C2,            0,           0,             0;
                  0,-1/R2-1i*w*C3,           0,             0;
                  0,            0,-1/R3-1i*w*C4,            0;
                  0,            0,            0,-1/R4-1i*w*C1];
A11 = -M12\M11;
A12 = I/M12;
A21 = M21-M22/M12*M11;
A22 = M22/M12;
A   = [A11,A12;A21,A22];




              